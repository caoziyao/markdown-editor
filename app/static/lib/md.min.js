var $jscomp = {scope: {}};
$jscomp.defineProperty = "function" == typeof Object.defineProperties ? Object.defineProperty : function (a, b, c) {
    if (c.get || c.set) throw new TypeError("ES3 does not support getters and setters.");
    a != Array.prototype && a != Object.prototype && (a[b] = c.value)
};
$jscomp.getGlobal = function (a) {
    return "undefined" != typeof window && window === a ? a : "undefined" != typeof global ? global : a
};
$jscomp.global = $jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX = "jscomp_symbol_";
$jscomp.initSymbol = function () {
    $jscomp.initSymbol = function () {
    };
    $jscomp.global.Symbol || ($jscomp.global.Symbol = $jscomp.Symbol)
};
$jscomp.symbolCounter_ = 0;
$jscomp.Symbol = function (a) {
    return $jscomp.SYMBOL_PREFIX + (a || "") + $jscomp.symbolCounter_++
};
$jscomp.initSymbolIterator = function () {
    $jscomp.initSymbol();
    var a = $jscomp.global.Symbol.iterator;
    a || (a = $jscomp.global.Symbol.iterator = $jscomp.global.Symbol("iterator"));
    "function" != typeof Array.prototype[a] && $jscomp.defineProperty(Array.prototype, a, {
        configurable: !0,
        writable: !0,
        value: function () {
            return $jscomp.arrayIterator(this)
        }
    });
    $jscomp.initSymbolIterator = function () {
    }
};
$jscomp.arrayIterator = function (a) {
    var b = 0;
    return $jscomp.iteratorPrototype(function () {
        return b < a.length ? {done: !1, value: a[b++]} : {done: !0}
    })
};
$jscomp.iteratorPrototype = function (a) {
    $jscomp.initSymbolIterator();
    a = {next: a};
    a[$jscomp.global.Symbol.iterator] = function () {
        return this
    };
    return a
};
$jscomp.makeIterator = function (a) {
    $jscomp.initSymbolIterator();
    var b = a[Symbol.iterator];
    return b ? b.call(a) : $jscomp.arrayIterator(a)
};
var log = console.log.bind(console, "\x3e\x3e\x3e");
String.prototype.html = function () {
    return this.slice(this.indexOf("\x3c")).replace(/>(\s+)</img, "\x3e\x3c")
};
var Sea = function (a) {
    this.arr = Array.from(document.querySelectorAll(a))
};
Sea.search = function (a) {
    for (var b = {}, c = location.search.slice(1).split("\x26"), c = $jscomp.makeIterator(c), d = c.next(); !d.done; d = c.next()) d = d.value.split("\x3d"), b[d[0]] = d[1];
    return a ? b[a] : b
};
Sea.css = function (a, b) {
    var c = "", d;
    for (d in a) c += d + ":" + a[d] + ";";
    b && (c = b + "{" + c + "}");
    return c
};
Sea.Ajax = function (a) {
    var b = {
        url: a.url,
        data: JSON.stringify(a.data) || null,
        method: (a.method || "POST").toUpperCase(),
        header: a.header || {},
        contentType: a.contentType || "application/json",
        callback: a.callback
    }, c = new XMLHttpRequest;
    return new Promise(function (a, e) {
        c.open(b.method, b.url, !0);
        c.setRequestHeader("Content-Type", b.contentType);
        for (var d in b.header) c.setRequestHeader(d, b.header[d]);
        c.onreadystatechange = function () {
            if (4 === c.readyState) {
                var d = c.response;
                "function" === typeof b.callback && b.callback(d);
                a(d)
            }
        };
        c.onerror = function (a) {
            e(a)
        };
        "GET" === b.method ? c.send() : c.send(b.data)
    })
};
window.eval = void 0;
$("#edit, #toc .btn").hide();
window.md = new Remarkable({
    linkTarget: "_blank",
    linkify: !1,
    html: !0,
    breaks: !0,
    xhtmlOut: !0,
    typographer: !0,
    highlight: function (a, b) {
        if (b && hljs.getLanguage(b)) try {
            return hljs.highlight(b, a).value
        } catch (c) {
        }
        try {
            return hljs.highlightAuto(a).value
        } catch (c) {
        }
        return ""
    }
});
md.core.ruler.enable(["abbr"]);
md.block.ruler.enable(["footnote", "deflist"]);
md.inline.ruler.enable(["footnote_inline", "ins", "mark", "sub", "sup"]);
md.info = document.querySelector("params").dataset;
md.md = $("#md")[0];
md.view = $("#edit view")[0];
md.edit = $("#edit textarea")[0];
md.editON = !1;
md.parseTitle = function () {
    for (var a = md.arr, b = [], c = 0; c < a.length; c++) {
        var d = a[c].match(/((#+?) [\s\S]+?)\n/);
        if (d) {
            var e = d[1].replace(/<[\s\S]+>|\([\s\S]+\)|[\[\]*#]/g, "").slice(1);
            b.push({msg: e, id: c, level: d[2].length})
        }
    }
    return b
};
md.initTOC = function () {
    for (var a = md.parseTitle(), b = {level: 1}, c = 0, d = '\x3cli\x3e\x3ca href\x3d"#title"\x3e' + md.title + "\x3c/a\x3e\x3c/li\x3e", a = $jscomp.makeIterator(a), e = a.next(); !e.done; e = a.next()) {
        var e = e.value, g = e.level;
        if (1 === g) {
            for (var f = 0; f < c; f++) d += "\x3c/ul\x3e";
            c = 0
        } else if (g > b.level) for (f = 0; f < g - b.level; f++) d += "\x3cul\x3e", c++; else if (g < b.level) for (f = 0; f < b.level - g; f++) d += "\x3c/ul\x3e";
        d += '\x3cli\x3e\x3ca href\x3d"#' + e.id + '"\x3e' + e.msg + "\x3c/a\x3e\x3c/li\x3e";
        b = e
    }
    $("#toc .list").html(d)
};
md.initHtml = function () {
    var a = '\x3ca name\x3d"title"\x3e\x3c/a\x3e\x3ch1 id\x3d"title"\x3e' + md.title + "\x3c/h1\x3e";
    md.parseTitle();
    for (var b = 0; b < md.arr.length; b++) a += "\x3ca name\x3d" + b + "\x3e\x3c/a\x3e\x3csea data-id\x3d" + b + "\x3e" + md.render(md.arr[b]) + "\x3c/sea\x3e";
    $("#md").html(a)
};
$("#set").on("click", function () {
    md.tocON ? (md.tocON = !1, $("#toc").animate({opacity: "hide"})) : (md.tocON = !0, $("#toc").animate({opacity: "show"}))
});
$("#toc .btn-edit").on("click", function () {
    var a = $(this).children("i"), b = $("#toc .btn-save"), c = $(".css-edit");
    if (md.editON) md.editON = !1, a.removeClass("fa-toggle-on"), a.addClass("fa-toggle-off"), c.html(""), b.hide(); else {
        md.editON = !0;
        a.removeClass("fa-toggle-off");
        a.addClass("fa-toggle-on");
        var a = Sea.css({display: "block", cursor: "zoom-in"}, "sea"),
            d = Sea.css({background: "rgba(230,231,236,0.33)", "border-radius": ".25rem"}, "sea:hover");
        c.html(a + d);
        b.show()
    }
});
$("#toc .btn-save").on("click", function () {
    confirm("\u786e\u8ba4\u4fdd\u5b58\u5f53\u524d\u4fee\u6539\u5417\uff1f") && Sea.Ajax({
        url: "/note/save",
        data: {info: md.info, arr: md.arr}
    }).then(function (a) {
        log(a);
        $("#toc .btn-edit").click()
    })
});
$("#edit .btn-add").on("click", function () {
    var a = md.edit.value;
    a ? md.arr[md.id] = a + "\n" : md.arr.splice(md.id, 1);
    md.arr.splice(md.id, 1, md.arr[md.id], '\n\x3e # \x3d\x3dnew title\x3d\x3d \x3ci class\x3d"fa fa-quote-left fa-3x"\x3e\x3c/i\x3e\n\x3ci class\x3d"fa fa-quote-right fa-3x"\x3e\x3c/i\x3e');
    md.initTOC();
    md.initHtml();
    md.tocON && $("#set").click();
    $("#edit").animate({height: "hide"});
    md.md.style.overflow = "";
    location = "#" + String(md.id + 1)
});
$("#md").on("mousedown", function (a) {
    md.tocON && $("#set").click()
});
$("#md").on("mousedown", "sea", function (a) {
    md.editON && (md.sea = this, md.id = Number(a.currentTarget.dataset.id), a = md.arr[md.id], md.edit.value = a, md.view.innerHTML = md.render(a), $("#edit").animate({height: "show"}), md.edit.scrollTop = 0, md.md.style.overflow = "hidden")
});
$("#edit").on("mousedown", function (a) {
    "edit" === a.target.id && ((a = md.edit.value) ? md.arr[md.id] = a + "\n" : md.arr.splice(md.id, 1), md.initTOC(), md.initHtml(), md.tocON && $("#set").click(), $("#edit").animate({height: "hide"}), md.md.style.overflow = "")
});
$("#edit textarea").on("scroll", function () {
    var a = this.scrollHeight, b = md.view.scrollHeight, c = a / b;
    1 > c && (c = b / a);
    c = Math.floor(c * this.scrollTop);
    1 > a - this.clientHeight - this.scrollTop && (c = b);
    md.view.scrollTop = c
});
$("#edit textarea").on("input", function () {
    md.view.innerHTML = md.render(this.value)
});
Sea.Ajax({url: "/note/load", data: md.info}).then(function (a) {
    a = JSON.parse(a);
    md.title = a.name || "";
    a.ok ? (md.arr = a.arr.length ? a.arr : ['# \u65b0\u5efa\u7b14\u8bb0\n\u70b9\u51fb\u53f3\u4e0a\u89d2 \x3ci class\x3d"fa fa-list-ul"\x3e\x3c/i\x3e \u5f00\u542f\u7f16\u8f91'], document.title = md.info.name + " - " + md.title, a.edit && $("#toc .btn-edit").show(), location.hash && (location = location.href)) : md.arr = ["# \u8be5\u7b14\u8bb0\u4e0d\u5b58\u5728\n[\u8bf7\u8fd4\u56de\u4e3b\u9875](https://bigc.cc)"];
    md.initTOC();
    md.initHtml()
});